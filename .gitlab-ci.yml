stages:
  - lint
  - compile
  - test
  
variables:
  MAVEN_OPTS: "-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository"
  POSTGRES_PORT: 5432

cache:
  paths:
    - .m2/repository

default:
  image: maven:3.9.9-eclipse-temurin-21

# Lint job for the frontend
lint_frontend:
  stage: lint
  image: node:18
  cache:
    paths:
      - smile-select-frontend/node_modules
  script:
    - echo "Installing dependencies for linting..."
    - cd smile-select-frontend
    - npm install
    - echo "Running linting on the frontend..."
    - npm run lint
  tags:
    - docker
  only:
    - merge_requests
    - branches
  allow_failure: false

# Compile jobs for each microservice
compile_appointment_service:
  stage: compile
  script:
    - echo "Compiling Appointment Service..."
    - mvn -B clean compile --file backend/services/appointment-service/pom.xml
  tags:
    - docker
  artifacts:
    expire_in: 1 week
    paths:
      - backend/services/appointment-service/target

compile_auth_service:
  stage: compile
  script:
    - echo "Compiling Authentication Service..."
    - mvn -B clean compile --file backend/services/auth-service/pom.xml
  tags:
    - docker
  artifacts:
    expire_in: 1 week
    paths:
      - backend/services/auth-service/target

# Job for frontend build
build_vue_frontend:
  stage: compile
  image: node:18
  script:
    - echo "Installing dependencies for Vue.js frontend..."
    - cd smile-select-frontend
    - npm install
    - echo "Building Vue.js frontend..."
    - npm run build
  tags:
    - docker
  artifacts:
    expire_in: 1 week
    paths:
      - smile-select-frontend/dist
